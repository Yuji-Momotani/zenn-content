---
title: "Goè¨€èªã‚’åŸºç¤ã‹ã‚‰å¾¹åº•çš„ã«å©ãè¾¼ã‚€ã€œ#4-3 Webé–‹ç™ºåŸºç¤ã€œ"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go"]
published: false
---

# æ¦‚è¦

[ã“ã®è¨˜äº‹]()ã®ç¶šãã§ã™ï¼  
Go ã§ã® Web é–‹ç™ºã®åŸºç¤ã«ã¤ã„ã¦ã§ã™ï¼

# Web é–‹ç™ºåŸºç¤

Go ã§ Web é–‹ç™ºã™ã‚‹å ´åˆã€Echo ã‚„ Gin ãªã©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ãŒä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ãŒã€ä»Šå›ã¯æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å«ã¾ã‚Œã‚‹æ©Ÿèƒ½ã‚’ä¸»ã«è¦‹ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ï¼

## net/url

URL ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã€‚URL ã«å•é¡ŒãŒã‚ã‚Œã°ã“ã“ã§æ¤œçŸ¥ã§ãã‚‹ã€‚

```go
base, err := url.Parse("https://example.com")
if err != nil {
	// ã‚¨ãƒ©ãƒ¼å‡¦ç†
}
reference, err := url.Parse("/test?a=1&b=2")
if err != nil {
	// ã‚¨ãƒ©ãƒ¼å‡¦ç†
}
endpoint := base.ResolveReference(reference).String()
fmt.Println(endpoint) // https://example.com/test?a=1&b=2
```

## net/http

net/http ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿ã§ç°¡å˜ãª Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚  
å¤šãã® Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆEcho ã‚„ Gin ãªã©ï¼‰ã‚‚å†…éƒ¨çš„ã«ã¯ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡

ä»¥ä¸‹ã¯ã€ã¨ã‚ã‚‹ãƒšãƒ¼ã‚¸ã« å˜ç´”ã« Get ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ä¾‹

```go
resp, err := http.Get("http://example.com")
if err != nil {
	log.Fatalln(err)
}
defer resp.Body.Close()
body, _ := io.ReadAll(resp.Body)
fmt.Println(string(body))
```

ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ã«ã¤ã„ã¦ã‚‚è©³ç´°ã‚’è¦‹ã¦ã„ãã¨ã€Body ã‚„ Header ã«å€¤ã‚’å«ã‚ãŸã‚Šã€Post ã§é€ä¿¡ã—ãŸã‚Šã¨æ§˜ã€…ã‚ã‚‹ãŒã€Web é–‹ç™ºã®éš›ã«ãã“ã¾ã§ä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ã¯ãªã„ã®ã§ã€ä¸€æ—¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã“ã“ã¾ã§ã§å‰²æ„›ã™ã‚‹ã€‚

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

`HandleFunc`ï¼ˆ`Handle`ï¼‰ã‚’ä½¿ã£ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®šã§ãã‚‹ã€‚  
ä»¥ä¸‹ã®ã¨ãŠã‚Šã€ç¬¬ä¸€å¼•æ•°ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‘ã‚¹ã€ç¬¬äºŒå¼•æ•°ã«é–¢æ•°ã‚’ã¨ã‚‹ã€‚é–¢æ•°ã®ç¬¬ä¸€å¼•æ•°`w`ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ›¸ãè¾¼ã‚€ãŸã‚ã® io.Writerã€‚ç¬¬äºŒå¼•æ•°ã®`r`ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã€‚

```go
func main() {
	http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
		fmt.Fprintln(w, "Hello World!")
	})
	http.ListenAndServe(":8080", nil)
}
```

`HandleFunc`ã¨`Handle`ã¯å¼•æ•°ã«é–¢æ•°ã‚’å–ã‚‹ã‹ã©ã†ã‹ã ã‘ã§ã€ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯åŒã˜ã€‚  
ä»¥ä¸‹ã¯ã©ã¡ã‚‰ã‚‚åŒç¾©ã§ã‚ã‚‹ã€‚

```go
http.HandleFunc("/handle/func", func(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintln(w, "HandleFunc")
})

http.Handle("/handle", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
	fmt.Fprintln(w, "Handle")
}))
http.ListenAndServe(":8080", nil)
```

#### HTTP ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ãƒãƒ³ãƒ‰ãƒ©ã®ç™»éŒ²

`GET`ã‚„`POST`ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã«ãƒãƒ³ãƒ‰ãƒ©ã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ã¯ã§ããªã„ã€‚  
`GET`ã‚„`POST`ã‚’åŒºåˆ¥ã—ã¦ãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®šã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«`switch`æ–‡ã§è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```go
http.HandleFunc("/handle/func", func(w http.ResponseWriter, r *http.Request) {
	switch r.Method {
	case http.MethodGet:
		fmt.Fprintln(w, "get handle func")
	case http.MethodPost:
		fmt.Fprintln(w, "post handle func")
	default:
		fmt.Fprintln(w, "invalid method")
	}
})
http.ListenAndServe(":8080", nil)
```

ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã®ãƒãƒ³ãƒ‰ãƒ©ã®ç™»éŒ²ã¯ Echo ãªã©ã® Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ç°¡æ½”ã«è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

## html/template

æ¨™æº–ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã€‚  
ãŸã ã€Go ãŒ Web ã‚¢ãƒ—ãƒªãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã§ä½¿ç”¨ã•ã‚Œã‚‹å ´åˆã¯ã€ API ã¨ã—ã¦ã®ç”¨é€”ãŒå¤šã„ãŸã‚ã€ä»Šå›ã¯çœç•¥ã€‚

## encoding/json

json å½¢å¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ Go ã®ã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†æ§‹é€ ä½“ã®å½¢å¼ã«ã—ãŸã‚Šã€ã¾ãŸãã®é€†ã‚’ã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚’ãƒãƒ¼ã‚·ãƒ£ãƒ«ï¼ˆMarshalï¼‰ã€ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ï¼ˆUnmarshalï¼‰ã¨ã„ã†ã€‚  
C#ãªã©ã§ã¯ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã€ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã¨è¨€ã‚ã‚ŒãŸã‚Šã™ã‚‹ã€‚  
ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¶Šã—ã«ãƒ‡ãƒ¼ã‚¿ã®ã‚„ã‚Šå–ã‚Šã‚’ã™ã‚‹éš›ã«é »ç™ºã™ã‚‹ã€‚

### ãƒãƒ¼ã‚·ãƒ£ãƒ«ï¼ˆMarshalï¼‰

ãƒãƒ¼ã‚·ãƒ£ãƒ«ã¯ Go ã®æ§‹é€ ä½“ãƒ‡ãƒ¼ã‚¿ã‚’ json å½¢å¼ã«ã™ã‚‹ã“ã¨ã€‚

```go
type Person struct {
	Name      string
	Age       int
	Nicknames []string
}

func main() {
	p := Person{
		Name:      "mike",
		Age:       20,
		Nicknames: []string{"mi", "mk", "m"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v)) // {"Name":"mike","Age":20,"Nicknames":["mi","mk","m"]}
}
```

json å½¢å¼ã«ã—ãŸã„éš›ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’ãƒ­ãƒ¯ãƒ¼ã‚±ãƒ¼ã‚¹ã«ã—ãŸã‚Šã€ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«ã—ãŸã„å ´åˆã€æ§‹é€ ä½“ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå®šç¾©ã‚’ã™ã‚‹ã€‚

```go
type Person struct {
	Name      string   `json:"name"`
	Age       int      `json:"age"`
	Nicknames []string `json:"nick_names"`
}

func main() {
	p := Person{
		Name:      "mike",
		Age:       20,
		Nicknames: []string{"mi", "mk", "m"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v)) //{"name":"mike","age":20,"nick_names":["mi","mk","m"]}
}
```

### ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ï¼ˆUnmarshalï¼‰

ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ã¯ json ã§å…¥ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’ Go ã®æ§‹é€ ä½“ã®å½¢å¼ã«ã™ã‚‹ã“ã¨ã€‚

```go
type Person struct {
	Name      string
	Age       int
	Nicknames []string
}

func main() {
	b := []byte(`{"name":"mike", "age":20,"nicknames":["mk","mi","m"]}`)
	var p Person
	if err := json.Unmarshal(b, &p); err != nil {
		fmt.Println(err)
	}
	fmt.Println(p) // {mike 20 [mk mi m]}
}
```

### ç©ºã®å ´åˆã€é …ç›®ã”ã¨å‰Šé™¤ã™ã‚‹

ä»¥ä¸‹ã®ã‚ˆã†ã«`omitempty`ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§å€¤ãŒç©ºã®å ´åˆã¯ã€é …ç›®ã”ã¨æ¶ˆã—ã¦ãã‚Œã‚‹ã€‚  
ä»¥ä¸‹ã®å ´åˆã€`name`ã¯ç©ºã®æ–‡å­—åˆ—ã®ãŸã‚ã€ãƒãƒ¼ã‚·ãƒ£ãƒ«ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§é …ç›®ã”ã¨å‰Šé™¤ã•ã‚Œã‚‹ã€‚

```go
type Person struct {
	Name      string   `json:"name,omitempty"`
	Age       int      `json:"age"`
	Nicknames []string `json:"nick_names"`
}

func main() {
	p := Person{
		Name:      "",
		Age:       20,
		Nicknames: []string{"mi", "mk", "m"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v)) //{"age":20,"nick_names":["mi","mk","m"]}
}
```

ãŸã ã—ã€ä»¥ä¸‹æ³¨æ„ç‚¹ã¨ã—ã¦ã€è‡ªåˆ†ã§å®šç¾©ã—ãŸæ§‹é€ ä½“ã®å ´åˆã€ãƒã‚¤ãƒ³ã‚¿å‹ã«ã—ãªã„ã¨`omitempty`ãŒåŠ¹ã‹ãªã„ã€‚

```go
type T struct{}

type Person struct {
	Name      string   `json:"name,omitempty"`
	Age       int      `json:"age,omitempty"`
	Nicknames []string `json:"nick_names,omitempty"`
	T         T        `json:"t,omitempty"`
	T2        *T       `json:"t2,omitempty"`
}

func main() {
	p := Person{
		Name:      "",
		Age:       20,
		Nicknames: []string{"mi", "mk", "m"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v)) // {"age":20,"nick_names":["mi","mk","m"],"t":{}}
}
```

ï¼ˆPerson ã® T ã¯ omitempty ãŒåŠ¹ã‹ãšã€ç©ºã®é …ç›®ã¨ã—ã¦å«ã¾ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ã€‚ãƒã‚¤ãƒ³ã‚¿å‹ã ã¨å•é¡ŒãªãåŠ¹ãï¼‰

### ãƒãƒ¼ã‚·ãƒ£ãƒ«ã¨ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã€‚

è‡ªåˆ†ãŒç‹¬è‡ªã«å®šç¾©ã—ãŸå½¢å¼ã§ãƒãƒ¼ã‚·ãƒ£ãƒ«ã¨ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ã‚’ã—ã¦ã»ã—ã„å ´åˆã¯ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚  
Stringer ã® String ãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒæ§˜ã«`MarshalJSON`ã¨`UnmarshalJSON`ã¯ç‰¹åˆ¥ãªãƒ¡ã‚½ãƒƒãƒ‰ã¨è¦šãˆã¦ãŠãã¨è‰¯ã„ã€‚

#### ãƒãƒ¼ã‚·ãƒ£ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸä¾‹

```go
type Person struct {
	Name      string   `json:"name"`
	Age       int      `json:"age"`
	Nicknames []string `json:"nick_names"`
}

func (p Person) MarshalJSON() ([]byte, error) {
	v, err := json.Marshal(&struct {
		Name string
	}{
		Name: "Mr." + p.Name,
	})
	return v, err
}

func main() {
	p := Person{
		Name:      "Mike",
		Age:       20,
		Nicknames: []string{"mi", "mk", "m"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v)) //{"Name":"Mr.Mike"}
}
```

#### ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸä¾‹

```go
func (p *Person) UnmarshalJSON(b []byte) error {
	type Person2 struct {
		Name string
	}
	var p2 Person2
	err := json.Unmarshal(b, &p2)
	if err != nil {
		fmt.Println(err)
	}
	p.Name = p2.Name + "!"
	return err
}

func main() {
	b := []byte(`{"name": "mike","age":20,"nicknames":[]}`)
	var p Person
	if err := json.Unmarshal(b, &p); err != nil {
		fmt.Println(err)
	}
	fmt.Println(p) //{mike! 0 []}
}
```

## context

ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’æä¾›ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€‚  
API ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹å ´åˆã€net/http ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®`*http.Request`ã®`Context`ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’åˆ©ç”¨ã™ã‚‹ã€‚  
è‡ªä½œã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§åˆ©ç”¨ã—ãªãã¦ã‚‚`context.Context`å‹ã®å€¤ã¯å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¹ãã€‚ãã†ã—ãªã„ã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’ä¼æ¬ã§ããªã„ã‹ã‚‰ã€‚ï¼ˆç¾åœ¨ã®å¤šãã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹é–¢æ•°ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã¯ç¬¬ä¸€å¼•æ•°ã«`context.Context`å‹ã®å€¤ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚ï¼‰

ä»¥ä¸‹ã¯ä¾‹

```go
func HandleOriginalFunc(w http.ResponseWriter, r *http.Request) {
	b, err := GetBook(r.Context(), 1)

}

func GetBook(ctx context.Context, id int) (*Book, error) {
	rows, err := db.QueryContext(ctx, "SELECT ....çœç•¥")
}
```

ä»¥ä¸‹ã¯ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸå ´åˆã«å‡¦ç†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ä¾‹

```go
func longProcess(ctx context.Context, ch chan string) {
	fmt.Println("é–‹å§‹")
	time.Sleep(2 * time.Second)
	fmt.Println("çµ‚äº†")
	ch <- "å®Ÿè¡Œçµæœ"
}

func main() {
	ch := make(chan string)
	ctx := context.Background()
	ctx, cancel := context.WithTimeout(ctx, 1*time.Second)
	defer cancel()

	go longProcess(ctx, ch)
L:
	for {
		select {
		case <-ctx.Done():
			fmt.Println("Error")
			fmt.Println(ctx.Err())
			break L
		case s := <-ch:
			fmt.Println(s)
			fmt.Println("success")
			break L
		}
	}
}
```

- `ctx := context.Background()`ã§ context ã®ä½œæˆ
- `ctx, cancel := context.WithTimeout(ctx, 1*time.Second)` ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®æ™‚é–“ã‚’è¨­å®š
  ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ 1 ç§’é–“ã«è¨­å®šã—ã¦ãŠã‚Šã€`longProcess`ã§ 2 ç§’ä»¥ä¸Šã‹ã‹ã‚‹ã®ã§ã€å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã€for æ–‡ã«å…¥ã‚‹ã¨ã„ã†æµã‚Œã«ãªã‚‹ã€‚

## database/sql ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

DB ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

### sql.Open é–¢æ•°

sql.Open é–¢æ•°ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ èµ·å‹•æ™‚ã«ä¸€åº¦ã®ã¿å®Ÿè¡Œã™ã‚Œã° OK ã¨ãªã‚Šã¾ã™ã€‚  
ç†ç”±ã¯ã€database/sql ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ—ãƒ¼ãƒ«ã—ã¦ãŠãæ©Ÿèƒ½ãŒã‚ã‚‹ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã™ã‚‹ã¾ã§ Cloese ã™ã‚‹å¿…è¦ã¯ãªã„ã‹ã‚‰ã§ã™ï¼

### sql.ErrorNoRows

sql.ErrorNoRows ã‚¨ãƒ©ãƒ¼ã¨ã¯ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå–å¾—ã§ããªã‹ã£ãŸæ™‚ã«ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã§ã™ãŒã€ã“ã‚Œã¯`*sql.Row`å‹ãŒæˆ»ã‚Šå€¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿ç™ºç”Ÿã—ã¾ã™ã€‚  
sql.QueryRow.Scan ã§ã‚¹ã‚­ãƒ£ãƒ³ã§ãã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„ãŸã‚ã€ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ©ãƒ¼ã§ã‚ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå ´åˆã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚

```go
rows, err := r.db.QueryContext(ctx, "SELECT name FROM users WHERE age=?", age)
if errors.Is(err, sql.ErrNoRows){
	//ã“ã®æ¡ä»¶ã‚’æº€ãŸã™ã“ã¨ã¯ãªã„
}
```

ã“ã®ä¾‹ã‹ã‚‰ã‚‚åˆ†ã‹ã‚‹ã‚ˆã†ã«æ³¨æ„ã—ã¦ãŠãã¹ãã“ã¨ã¯ã€ãã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯æœ¬å½“ã«`sql.ErrNoRows`ã‚’è¿”ã™ã®ã‹ï¼Ÿã¨ã„ã†ã“ã¨ã§ã™ã€‚

### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†æ™‚ã¯ã€`defer`æ–‡ã§å‡¦ç†ã‚’æŠœã‘ã‚‹æ™‚ã«å¿…ãš`Rollback`ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ãªã‚Šã¾ã™ã€‚  
ç†ç”±ã¨ã—ã¦ã¯ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã”ã¨ã«`Rollback`ã‚’è¨˜è¿°ã—ã¦ã„ã‚‹ã¨æ¼ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚  
ãã®ãŸã‚ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å•é¡Œãªãå‡¦ç†ãŒæˆåŠŸã—ãŸå ´åˆã¯ã€`Commit`ã•ã‚ŒãŸã®ã¡ã€`Rollback`ãŒèµ°ã‚‹ã“ã¨ã«ãªã‚‹ãŒã€ã“ã‚Œã¯ç‰¹ã«å•é¡Œã«ã¯ãªã‚‰ãªã„ï¼ˆRollback ãƒ¡ã‚½ãƒƒãƒ‰ã¯ Commit æ¸ˆã¿ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã‚‚ RDBMS ä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã¯ãªã„ï¼‰ã€‚ãã‚Œã‚ˆã‚Šã€å•é¡ŒãŒã‚ã£ãŸå ´åˆã«ã€`Rollback`ã‚’å¿˜ã‚Œã‚‹æ–¹ãŒå•é¡Œã§ã‚ã‚‹ãŸã‚ã€`defer`æ–‡ã§å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

# ã¾ã¨ã‚

ã–ã£ã¨æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ãŠã‘ã‚‹ Web é–‹ç™ºã®åŸºæœ¬çš„ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¦‹ã¦ã„ãã¾ã—ãŸã€‚  
æ¬¡å›ã¯ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¤ã„ã¦ç°¡å˜ã«è¦‹ã¦ã„ãã¾ã™ã€‚
