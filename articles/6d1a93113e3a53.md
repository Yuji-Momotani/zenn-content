---
title: "Golangã§ã®Jsonã®æ‰±ã„æ–¹"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "json"]
published: false
---

## æ¦‚è¦

Golang ã§ã® Json ã®æ‰±ã„æ–¹ã«è¿·ã†ã“ã¨ãŒã‚ã£ãŸã®ã§ã¾ã¨ã‚ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚

## ãã‚‚ãã‚‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã¨ã¯

### ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼‰ã¨ã¯

ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ JSON å½¢å¼ã®æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã®ã“ã¨ã€‚
Golang ã§ã„ã†ã¨ã€Struct ã‹ã‚‰ Json å½¢å¼ï¼ˆã‚¹ãƒ©ã‚¤ã‚¹ã® byteï¼‰ã«å¤‰æ›ã™ã‚‹ã“ã¨ã€‚

### ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºï¼‰ã¨ã¯

ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã¯é€†ã§ JSON ã®æ–‡å­—åˆ—ã‚’ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æˆ»ã™ãƒ—ãƒ­ã‚»ã‚¹ã€‚
Golang ã§ã„ã†ã¨ã€JSON å½¢å¼ï¼ˆã‚¹ãƒ©ã‚¤ã‚¹ã® byteï¼‰ã‹ã‚‰ struct ã«å¤‰æ›ã™ã‚‹ã“ã¨ã€‚

## Golang ã§ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã€ãƒ‡ã‚³ãƒ¼ãƒ‰

#### ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰

Golang ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯ Marshalï¼ˆãƒãƒ¼ã‚·ãƒ£ãƒ«ï¼‰ã¨è¨€ã„ã¾ã™ã€‚
å…·ä½“çš„ã«ã¯ json.Marshal ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ã¡ãªã¿ã« JavaScript ã ã¨ JSON.stringfy ã§ã‚„ã£ã¦ã‚‹ã“ã¨ãŒã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```go
type Person struct {
	Name   string
	Age    int
	Family []string
}

func main() {
	p := Person{
		"mike",
		20,
		[]string{"son", "wife"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v))
}
// {"Name":"mike","Age":20,"Family":["son","wife"]}
```

ã—ã‹ã—ã€ã“ã®ã¾ã¾ã§ã¯ãƒãƒ¼ã‚·ãƒ£ãƒ«ã—ãŸéš›ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åãŒæ§‹é€ ä½“ã®å®šç¾©ã¨åŒã˜ãé ­æ–‡å­—ãŒå¤§æ–‡å­—ã«ãªã£ã¦ã„ã¾ã™ã€‚
é€šå¸¸ã€json å½¢å¼ã§ã¯å…ˆé ­å°æ–‡å­—ã®ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ãŒç”¨ã„ã‚‰ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚å„é …ç›®åã‚’ json ã«ã—ãŸéš›ã®å®šç¾©ã‚‚ struct ã§å®šç¾©ã§ãã¾ã™ã€‚

```go
type Person struct {
	Name   string   `json:"name"`
	Age    int      `json:"age"`
	Family []string `json:"family"`
}

func main() {
	p := Person{
		"mike",
		20,
		[]string{"son", "wife"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v))
}
// {"name":"mike","age":20,"family":["son","wife"]}
```

ã¾ãŸã€json.Marshal è‡ªä½“ã‚’ã‚ªãƒ¼ãƒãƒ©ã‚¤ãƒ‰ã—ã¦ã‚„ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ä¾‹ï¼šstruct ã«ã¯ Name,Age,Family ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€json ã§è¿”ã™ã¨ãã«ã¯ name ã—ã‹å¿…è¦ãªã„ã€‚

```go
type Person struct {
	Name   string   `json:"name"`
	Age    int      `json:"age"`
	Family []string `json:"family"`
}

func (p Person) MarshalJSON() ([]byte, error) {
	v, err := json.Marshal(&struct {
		Name string `json:"name"`
	}{
		Name: "Mr." + p.Name,
	})
	return v, err
}
func main() {
	p := Person{
		"mike",
		20,
		[]string{"son", "wife"},
	}
	v, _ := json.Marshal(p)
	fmt.Println(string(v))
}
```

#### ãƒ‡ã‚³ãƒ¼ãƒ‰

Golang ã§ã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã¯ Unmarshalï¼ˆã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ï¼‰ã¨è¨€ã„ã¾ã™ã€‚
å…·ä½“çš„ã«ã¯ json.Unmarshal ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ã¡ãªã¿ã« JavaScript ã§ã¯ JSON.parse ã§ã‚„ã£ã¦ã‚‹ã“ã¨ãŒãƒ‡ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

Go ã§ã‚„ã‚‹ã¨ã“ã†ãªã‚Šã¾ã™

```go
type Person struct {
	Name   string
	Age    int
	Family []string
}

func main() {
	b := []byte(`{"name": "mike", "age": 20, "family":["wife", "son"]}`)
	var p Person
	if err := json.Unmarshal(b, &p); err != nil {
		log.Fatalln("err")
	}
	fmt.Println(p)
}
// {mike 20 [wife son]
```

Unmarshal ã‚‚ Marshal ã¨åŒæ§˜ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

```go
type Person struct {
	Name   string   `json:"name"`
	Age    int      `json:"age"`
	Family []string `json:"family"`
}

func (p *Person) UnmarshalJSON(b []byte) error {
	type Person2 struct {
		Name string
	}
	var p2 Person2
	err := json.Unmarshal(b, &p2)
	if err != nil {
		log.Fatalln(err)
	}
	p.Name = "Mr." + p2.Name
	return err
}

func main() {
	b := []byte(`{"name":"Mike", "age": 20, "family":["son","wife"]}`)
	var p Person
	if err := json.Unmarshal(b, &p); err != nil {
		fmt.Println(err)
	}
	fmt.Println(p)
}
// {Mr.Mike 0 []}
```

### Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ãŸå ´åˆï¼ˆEchoï¼‰

ä¸Šè¨˜ã§ãƒãƒ¼ã‚·ãƒ£ãƒ«ã€ã‚¢ãƒ³ãƒãƒ¼ã‚·ãƒ£ãƒ«ã«ã¤ã„ã¦è¨˜è¿°ã—ã¦ã„ãã¾ã—ãŸãŒã€åŸºæœ¬çš„ã« Echo ã®ã‚ˆã†ãª Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ã“ã®ã‚ˆã†ãªå‡¦ç†ã¯è‡ªå‹•ã§è¡Œã£ã¦ãã‚Œã‚‹ã®ã§æ„è­˜ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ä¾‹ãˆã°ã€

- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼šc.JSON(statusCode, struct)
- ãƒ‡ã‚³ãƒ¼ãƒ‰: c.Bind(&struct)
  ã“ã®ã‚ˆã†ãªå½¢ã§é–‹ç™ºè€…ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦æ„è­˜ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¾¿åˆ©ã§ã™ã­ã€œæ„Ÿè¬
