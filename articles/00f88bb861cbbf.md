---
title: "ã€ãƒ¡ãƒ¢ã€‘GoÃ—EchoÃ—CleanArchitecture + ReactÃ—tailwindcssã§é–‹ç™ºã™ã‚‹éš›ã®æ‰‹é †ãƒ¡ãƒ¢"
emoji: "ğŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["go", "Echo", "GORM", "Clean Architecture", "React", "tailwindcss"]
published: false
---

## æ¦‚è¦

ã‚¿ã‚¤ãƒˆãƒ«ã®ã¨ãŠã‚Šã€

- backend
  - Go
  - Echo
  - CleanArchitecture
  - (GORM)
- frontend
  - React
  - tailwindcss

ä¸Šè¨˜ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã§ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã§ã¯é–‹ç™ºã—ã¦ã„ã‚‹ã®ã§ã€ç’°å¢ƒæ§‹ç¯‰ã®æµã‚Œã‚’è‡ªåˆ†ç”¨ã®ãƒ¡ãƒ¢æ›¸ãã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚

### å‚è€ƒæ•™æ

Golang ã§ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŸºç¤ã‚’å­¦ã‚“ã ä»¥ä¸‹ã®æ•™æã‚’å‚è€ƒã«ã—ã¦ã¾ã™ï¼ï¼ˆã‚ã¡ã‚ƒã‚ã‹ã‚Šã‚„ã™ã„ã®ã§ãŠã™ã™ã‚ï¼‰
[Udemy - ã€ŒEcho/Go + React ã§å§‹ã‚ã‚‹ãƒ¢ãƒ€ãƒ³ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã€](https://www.udemy.com/course/echo-go-react-restapi/)

## ç’°å¢ƒæ§‹ç¯‰æ‰‹é †

### ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ

- ã¾ãšã€ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚

```sh
mkdir hoge-app
```

- API ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚

```sh
cd hoge-app
mkdir frontend backend
```

### API ã®ç’°å¢ƒæ§‹ç¯‰æ‰‹é †

- go ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```sh
cd backend
# hoge-app-rest-apiã¯ä»»æ„ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
go mod init hoge-app-rest-api
```

- docker-compose ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```sh
touch docker-compose.yml
```

- docker-compose.yml
  docker ã§ DB(postgresql)ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹ã€‚

```yml
version: "3.8"
services:
  dev-postgres:
    image: postgres:15.1-alpine
    ports:
      - 5434:5432
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: mydb
    restart: always
    networks:
      - lesson
networks:
  lesson:
```

- .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„
  ç’°å¢ƒå¤‰æ•°ã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„

```sh
touch .env
```

```env
PORT=8080
POSTGRES_USER=user
POSTGRES_PW=password
POSTGRES_DB=mydb
POSTGRES_PORT=5434
POSTGRES_HOST=localhost
SECRET={JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹éš›ã«ä½¿ç”¨ã™ã‚‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼}
GO_ENV=dev
API_DOMAIN=localhost
FE_URL=http://localhost:3000
```

å„ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã—ã¦ã„ãã€‚

- CleanArchitecture ã§å®Ÿè£…ã—ã¦ã„ããŸã‚ã®å„å±¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€ãŠã‚ˆã³å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„

```sh
mkdir db migrate router controller usecase repository model validator
```

CleanArchitecture ã®å„å±¤ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å‘½åã¯ã”è‡ªç”±ã«

- ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’ç”¨æ„

```sh
touch main.go
```

- db/db.go ã‚’ä½œæˆã—ã€ç·¨é›†

```sh
touch db/db.go
```

db.go ã« db æ¥ç¶šã¨ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ãŸã‚ã®é–¢æ•°ã‚’ä½œæˆ

```go
package db

import (
	"fmt"
	"log"
	"os"

	"github.com/joho/godotenv"
	"gorm.io/driver/postgres"
	"gorm.io/gorm"
)

func NewDB() *gorm.DB {
	if os.Getenv("GO_ENV") == "dev" {
		err := godotenv.Load()
		if err != nil {
			log.Fatalln(err)
		}
	}
	url := fmt.Sprintf("postgres://%s:%s@%s:%s/%s", os.Getenv("POSTGRES_USER"),
		os.Getenv("POSTGRES_PW"), os.Getenv("POSTGRES_HOST"), os.Getenv("POSTGRES_PORT"), os.Getenv("POSTGRES_DB"))
	db, err := gorm.Open(postgres.Open(url), &gorm.Config{})
	if err != nil {
		log.Fatalln(err)
	}
	fmt.Println("db connected!")
	return db
}

func CloseDB(db *gorm.DB) {
	sqlDB, _ := db.DB()
	if err := sqlDB.Close(); err != nil {
		log.Fatalln(err)
	}
}
```

go mod tidy ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€gormã€godotenvã€postgresql ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã—ã¦ãŠãã€‚

- migrate/migrate.go ã‚’ä½œæˆã—ã€ç·¨é›†

```sh
touch migrate/migrate.go
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®é–¢æ•°ä½œæˆ

```go
package main

import (
	"fmt"
	"todo-rest-api/db"
	"todo-rest-api/model"
)

func main() {
	dbConn := db.NewDB()
	defer fmt.Println("Successfully Migrated")
	defer db.CloseDB(dbConn)
	// ä¾‹ï¼šuserã¨taskãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ãŸã„å ´åˆ
	dbConn.AutoMigrate(&model.User{}) //ä½œæˆã—ãŸã„ãƒ¢ãƒ‡ãƒ«ã®structã‚’0å€¤ã§å¼•æ•°ã«æ¸¡ã™
}
```

ä»¥ä¸‹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã‚’ã™ã‚‹ã“ã¨ã§ã€model å±¤ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ struct ã‚’å…ƒã«ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã€‚

```sh
#ã¾ãšdockerã‚’èµ·å‹•ã—ã¦ãŠã
docker-compose up -d
GO_ENV=dev go run migrate/migrate.go
```

ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œæ™‚ã«ã¯ã€GO_ENV=dev ã¨ã™ã‚‹ã“ã¨ã§ã€.env ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†ã‚ˆã†ã« NewDB é–¢æ•°å†…ã§å®šç¾©ã—ã¦ã„ã‚‹ã€‚
ã€ŒSuccessfully Migratedã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°æˆåŠŸã€‚

- ãƒ‡ãƒãƒƒã‚°ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã€‚ï¼ˆvscodeï¼‰

  - å‰æ
    - vscode ã® Extention ã®ã€ŒGoã€ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã€‚
    - delve ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Package",
      "type": "go",
      "request": "launch",
      "mode": "auto",
      "program": "${workspaceFolder}/main.go",
      "env": {
        "GO_ENV": "dev"
      }
    }
  ]
}
```

vscode ã®å®Ÿè¡Œã¨ãƒ‡ãƒãƒƒã‚°ã‹ã‚‰å®Ÿè¡Œ

- main.goï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼‰ã®ä½œæˆ

```go
package main

import (
	"todo-rest-api-3/db"
)

func main() {
	db.NewDB()
	// ä¾å­˜æ€§ã®æ³¨å…¥
	//repository
	//usecase
	//controller
	//router â†’ echo.Echoã‚’è¿”ã™
	e.Logger.Fatal(e.Start(":8080"))
}
```

- router.goï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åˆ¶å¾¡ï¼‰ã‚’ä½œæˆ

```sh
touch router/router.go
```

```go
package router

import (

	"github.com/labstack/echo/v4"
	"github.com/labstack/echo/v4/middleware"
)

func NewRouter(uc controller.IUserController) *echo.Echo {
	e := echo.New()

	//****************
	// ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åˆ¶å¾¡
	//****************

	e.Use(middleware.Logger())
	return e
}
```

- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä»¥ä¸‹ã‚’ä½œæˆ
  - openapi.yml

```sh
mkdir doc
touch doc/openapi.yml
```

ã‚µãƒ³ãƒ—ãƒ«

```yml
openapi: "3.0.3"

info:
  title: "TodoApp API"
  version: "1.0.0"

paths:
  "/signup":
    post:
      summary: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²"
      description: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²"
      deprecated: false #trueã®å ´åˆã€å»ƒæ­¢
      tags: ["authentication"]
      parameters: []
      requestBody:
        description: "emailã€passwordã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«å«ã‚ã‚‹"
        required: true # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãŒå¿…è¦ã‹å¦ã‹
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string, example: "testuser@test.com" }
                password: { type: string, example: "testpass" }
      responses:
        "201":
          description: "æˆåŠŸ"
        "400":
          description: "é€ä¿¡ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£"
          content:
            application/json:
              schema:
                type: object
                properties:
                  code: { type: string, example: 400 }
                  message: { type: string, example: "bad request" }
        "500":
          description: "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼"
          content:
            application/json:
              schema:
                type: object
                properties:
                  code: { type: string, example: 500 }
                  message: { type: string, example: "server error" }
  "/login":
    post:
      summary: "ãƒ­ã‚°ã‚¤ãƒ³"
      description: "ãƒ­ã‚°ã‚¤ãƒ³ï¼šæˆåŠŸæ™‚tokenç™ºè¡Œ"
      tags: ["authentication"]
      deprecated: false #trueã®å ´åˆã€å»ƒæ­¢
      requestBody:
        description: "emailã€passwordã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã«å«ã‚ã‚‹"
        required: true # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãŒå¿…è¦ã‹å¦ã‹
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string, example: "testuser@test.com" }
                password: { type: string, example: "testpass" }
      responses:
        "200":
          description: "æˆåŠŸ"
        "400":
          description: "é€ä¿¡ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£"
          content:
            application/json:
              schema:
                type: object
                properties:
                  code: { type: string, example: 400 }
                  message: { type: string, example: "bad request" }
        "500":
          description: "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼"
          content:
            application/json:
              schema:
                type: object
                properties:
                  code: { type: string, example: 500 }
                  message: { type: string, example: "server error" }
      security:
        - tokenKey: []

  "/logout":
    post:
      summary: "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"
      description: "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼šæˆåŠŸæ™‚tokenå¤±åŠ¹"
      tags: ["authentication"]
      deprecated: false #trueã®å ´åˆã€å»ƒæ­¢
      requestBody:
        description: "ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãªã—"
        required: false # ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãŒå¿…è¦ã‹å¦ã‹
        content: {}
      responses:
        "200":
          description: "æˆåŠŸ"
        "500":
          description: "ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼"
          content:
            application/json:
              schema:
                type: object
                properties:
                  code: { type: string, example: 500 }
                  message: { type: string, example: "server error" }
# security:
#   - tokenKey: []

components:
  securitySchemes:
    tokenKey:
      description: "JWT authentication"
      type: http
      scheme: bearer
      bearerFormat: JWT
```

- ãã®ä»–ã‚„ã‚‹ã“ã¨ï¼ˆrouterï¼‰
  - JWT ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š
  - CSRF ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š
  - CORS ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š

### frontend ã®ç’°å¢ƒæ§‹ç¯‰æ‰‹é †

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

```sh
npx create-react-app {ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå} --use-npm

# typescriptã‚’ä½¿ã†å ´åˆ
npx create-react-app {ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå} --template typescript --use-npm
```

- .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„

```sh
cd {ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå}
touch .env
```

```env
REACT_APP_API_URL=http://localhost:8080
```

- tailwindcss ã®å°å…¥

```sh
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init
```

- tailwind.config.js ã‚’æ›¸ãæ›ãˆã‚‹

```js
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: ["./src/**/*.{js,jsx,tx,tsx}"],
  theme: {
    extend: {},
  },
  plugins: [],
};
```

- index.css ã«è¨­å®š

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

## çµ‚ã‚ã‚Š

ä¸€æ—¦ã“ã‚Œã§é››å½¢ãŒã§ãã‚‹ã‹ã¨ï¼
